<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Scanner + A4 Delivery Sheet</title>

  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
  <style>
/* =========================
   WHITE-CLOTHES UI â€” V2 THEME (FULL)
   - Dark premium UI
   - Search results card looks different
   - Keeps PRINT/PDF rules safe
   ========================= */

:root{
  --bg:#0b1220;
  --bg2:#071022;
  --card:#0f1a31;
  --card2:#0c152b;
  --text:#e8eefc;
  --muted:rgba(232,238,252,.72);

  --line:rgba(255,255,255,.10);
  --line2:rgba(255,255,255,.16);

  --blue:#3b82f6;
  --blue2:#2563eb;

  --red:#ef4444;
  --amber:#f59e0b;
  --amber2:#fbbf24;
  --green:#22c55e;

  --radius:18px;
  --radius2:14px;

  --shadow: 0 14px 45px rgba(0,0,0,.42);
  --shadow2: 0 8px 25px rgba(0,0,0,.35);

  --glass: rgba(15,26,49,.72);
  --glass2: rgba(12,21,43,.70);
}

/* ============ Base ============ */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Arial;
  background:
    radial-gradient(1200px 700px at 12% 0%, #162a66 0%, transparent 62%),
    radial-gradient(900px 650px at 95% 12%, #0f3b55 0%, transparent 58%),
    radial-gradient(1000px 600px at 55% 110%, #0e1b44 0%, transparent 60%),
    linear-gradient(180deg, var(--bg2), var(--bg));
  color:var(--text);
  padding:14px;
}

body.search-open #ordersCard{
  opacity:.45;
  transform: scale(.99);
  filter: blur(1px);
  transition:.2s ease;
}

/* subtle grain */
body:before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none;
  background-image:
    radial-gradient(rgba(255,255,255,.06) 1px, transparent 1px);
  background-size: 18px 18px;
  opacity:.12;
  mix-blend-mode: overlay;
}

/* prevent row splitting */
tbody tr{break-inside: avoid; page-break-inside: avoid;}
@media print{
  tr, td, th { page-break-inside: avoid !important; }
  tbody tr { break-inside: avoid !important; }
}

.wrap{max-width:1100px;margin:0 auto}

/* ============ Topbar ============ */
.topbar{
  position:sticky; top:10px; z-index:30;
  backdrop-filter: blur(12px);
  background: linear-gradient(180deg, rgba(16,28,55,.78), rgba(12,21,43,.70));
  border:1px solid rgba(255,255,255,.10);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:12px 12px;
}
@media (max-width: 860px){
  .topbar{top:8px}
}

.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.right{margin-inline-start:auto}
.title{font-weight:950;font-size:18px;letter-spacing:.2px}
.muted{color:var(--muted)}

/* Pills */
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(10,18,34,.30);
  font-size:12px;
  white-space:nowrap;
  box-shadow: 0 6px 18px rgba(0,0,0,.22);
}
.pill b{font-weight:900}

/* ============ Card ============ */
.card{
  margin-top:12px;
  background: linear-gradient(180deg, rgba(16,28,55,.92), rgba(10,18,38,.92));
  border:1px solid rgba(255,255,255,.10);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:12px;
  position:relative;
  overflow:hidden;
}

/* a soft highlight */
.card::after{
  content:"";
  position:absolute;
  inset:-60px auto auto -80px;
  width:280px;
  height:280px;
  background: radial-gradient(circle at 30% 30%, rgba(59,130,246,.16), transparent 65%);
  opacity:.9;
  pointer-events:none;
}
.card > *{position:relative; z-index:2}

/* ============ Inputs & Buttons ============ */
input,select,button{
  border-radius: 16px;
  border:1px solid var(--line2);
  background: rgba(12,21,43,.72);
  color: var(--text);
  padding: 11px 12px;
  outline:none;
  transition:.15s ease;
  min-height: 44px;
}
input::placeholder{color:rgba(232,238,252,.44)}

input:focus,select:focus{
  border-color:rgba(59,130,246,.75);
  box-shadow:0 0 0 4px rgba(59,130,246,.18);
}

button{
  cursor:pointer;
  border:0;
  background: linear-gradient(180deg,var(--blue),var(--blue2));
  font-weight:900;
  letter-spacing:.2px;
  box-shadow: 0 12px 26px rgba(37,99,235,.18), 0 6px 18px rgba(0,0,0,.25);
}
button:active{transform: translateY(1px)}
button.secondary{
  background: rgba(148,163,184,.12);
  border:1px solid rgba(255,255,255,.14);
  box-shadow: 0 10px 22px rgba(0,0,0,.25);
  font-weight:900;
}
button.danger{
  background: linear-gradient(180deg,#ff6b6b,var(--red));
  box-shadow: 0 14px 30px rgba(239,68,68,.18), 0 8px 18px rgba(0,0,0,.25);
}
button.ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,.16);
  box-shadow:none;
}

/* nicer disabled */
button:disabled, input:disabled, select:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* Grid */
.grid{
  display:grid;
  grid-template-columns: 1.3fr 1fr 1fr;
  gap:10px;
}
@media (max-width: 860px){
  .grid{grid-template-columns:1fr}
}

/* ============ Tables ============ */
.tableWrap{
  width:100%;
  overflow:auto;
  border-radius: 16px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(10,18,34,.28);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  min-width: 980px;
}

thead th{
  position:sticky; top:0;
  background: rgba(10,18,34,.88);
  backdrop-filter: blur(10px);
  border-bottom:1px solid rgba(255,255,255,.10);
  padding:10px;
  text-align:right;
  font-size:12px;
  white-space:nowrap;
}

tbody td{
  border-bottom:1px solid rgba(255,255,255,.06);
  padding:10px;
  vertical-align:top;
  font-size:13px;
}
tbody tr:hover td{background: rgba(59,130,246,.06)}

.mono{font-variant-numeric: tabular-nums}
.addr{line-height:1.5}
.small{font-size:12px;color:var(--muted)}
.nowrap{white-space:nowrap}
.no-print{display:block}

/* badges */
.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  font-size:12px;
  white-space:nowrap;
  background: rgba(255,255,255,.05);
}
.b-ok{border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.12)}
.b-warn{border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.10)}
.b-err{border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.10)}

/* ============ QR ============ */
#qrWrap{display:none; margin-top:10px;}
#qrBoxOuter{
  position:relative;
  width:100%;
  max-width:560px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  overflow:hidden;
  background: rgba(12,21,43,.70);
  box-shadow: var(--shadow2);
}
#qr-reader{width:100%;}
#qrOverlay{
  position:absolute; inset:0;
  pointer-events:none;
  display:flex; align-items:center; justify-content:center;
}
#qrOverlay .frame{
  width:260px; height:260px;
  border-radius:18px;
  border:3px solid rgba(34,197,94,.92);
  box-shadow: 0 0 0 9999px rgba(0,0,0,.35);
  position:relative;
}
#qrOverlay .frame:after{
  content:"";
  position:absolute; inset:-10px;
  border-radius:22px;
  border:2px dashed rgba(245,158,11,.55);
}

/* ============ Toast ============ */
#toast{
  position:fixed;
  bottom:14px; left:14px; right:14px;
  max-width:540px;
  margin:auto;
  background: rgba(10,18,34,.92);
  border:1px solid rgba(255,255,255,.10);
  border-radius:16px;
  padding:10px 12px;
  display:none;
  z-index:9999;
  box-shadow: var(--shadow);
}

/* ===============================
   SEARCH RESULTS â€” LOOKS DIFFERENT
   =============================== */
.search-card{
  background: linear-gradient(180deg, rgba(25,40,82,.94), rgba(12,18,44,.96)) !important;
  border: 1px solid rgba(245,158,11,.55) !important;
  box-shadow:
    0 0 0 1px rgba(245,158,11,.16),
    0 18px 70px rgba(0,0,0,.62),
    0 0 40px rgba(245,158,11,.18) !important;
}

.search-card::before{
  content:"";
  display:block;
  height:4px;
  background: linear-gradient(90deg,#f59e0b,#ef4444);
  border-radius: 10px 10px 0 0;
  margin:-12px -12px 12px -12px;
}

/* label badge inside search card */
#searchResultsCard.search-card{
  position:relative;
  overflow:hidden;
}
#searchResultsCard.search-card::after{
  content:"";
  position:absolute;
  inset:-90px -120px auto auto;
  width:360px;
  height:360px;
  background:
    radial-gradient(circle at 30% 30%, rgba(245,158,11,.30), transparent 60%),
    radial-gradient(circle at 70% 70%, rgba(239,68,68,.16), transparent 55%);
  opacity:.95;
  pointer-events:none;
  z-index:1;
}
#searchResultsCard.search-card > *{position:relative; z-index:2}

#searchResultsCard.search-card .title{
  color: var(--amber2) !important;
  text-shadow: 0 0 18px rgba(245,158,11,.18);
}
#searchResultsCard.search-card .pill{
  border-color: rgba(245,158,11,.28) !important;
  background: rgba(245,158,11,.08) !important;
}

/* Search table differs */
#searchResultsCard.search-card .tableWrap{
  border-color: rgba(245,158,11,.20) !important;
  background: rgba(10,18,34,.34) !important;
}
#searchResultsCard.search-card thead th{
  background: rgba(16,24,46,.92) !important;
  border-bottom:1px solid rgba(245,158,11,.20) !important;
}
#searchResultsCard.search-card tbody tr:hover td{
  background: rgba(245,158,11,.10) !important;
}

/* ===============================
   OPTIONAL: subtle state when search open
   (we'll toggle body.search-open in JS)
   =============================== */
body.search-open .topbar{
  border-color: rgba(245,158,11,.20) !important;
  box-shadow: 0 0 28px rgba(245,158,11,.10), var(--shadow) !important;
}

/* =========================
   PRINT (KEEP YOUR ORIGINAL)
   ========================= */
@page { size: A4 landscape; margin: 8mm; }
.print-header,.print-summary{display:none}

@media print{
  body{background:#fff;color:#000;margin:0;padding:0;font-size:12px}
  .no-print{display:none !important}
  body:before{display:none !important}

  .wrap{max-width:none}
  .card{box-shadow:none;border:0;border-radius:0;background:#fff;padding:0;margin:0}
  .card::after{display:none}
  .tableWrap{border:0; overflow:visible; box-shadow:none}
  table{min-width:auto; width:100%}
  thead th{
    position:static;
    background:#f4f4f4;
    border:1px solid #ddd;
    font-size:11px;
    padding:7px;
  }
  tbody td{border:1px solid #ddd;padding:7px;font-size:11px}
  .print-header{display:block;margin-bottom:8px}
  .print-title{font-size:16px;font-weight:900;margin-bottom:2px}
  .print-summary{
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap:8px;
    margin:8px 0 12px 0;
  }
  .print-box{
    border:1px solid #ddd;border-radius:10px;padding:8px 10px;
  }
  .badge{border:1px solid #ddd;background:#fff}
}

/* =========================
   PDF MODE (KEEP SAFE)
   ========================= */
body.pdf-mode{
  background:#fff !important;
  color:#000 !important;
  margin:0 !important;
  padding:0 !important;
  font-size:12px !important;
}
body.pdf-mode:before{display:none !important}
body.pdf-mode .no-print{ display:none !important; }

body.pdf-mode .wrap{ max-width:none !important; }
body.pdf-mode #printArea{
  box-shadow:none !important;
  border:0 !important;
  border-radius:0 !important;
  background:#fff !important;
  padding:0 !important;
  margin:0 !important;
  width: 100% !important;
}
body.pdf-mode table{
  min-width: 0 !important;
  width: 100% !important;
}
body.pdf-mode #printArea{
  width: 297mm !important;
  min-height: 210mm !important;
}
body.pdf-mode .tableWrap{
  overflow: visible !important;
  border:0 !important;
  background:#fff !important;
  box-shadow:none !important;
}
body.pdf-mode #printArea{
  padding: 8mm !important;
  box-sizing: border-box !important;
}
body.pdf-mode .print-header{ display:block !important; margin-bottom:8px !important; }
body.pdf-mode .print-summary{
  display:grid !important;
  grid-template-columns: 1fr 1fr 1fr !important;
  gap:8px !important;
  margin:8px 0 12px 0 !important;
}
body.pdf-mode .print-box{ border:1px solid #ddd !important; border-radius:10px !important; padding:8px 10px !important; }

body.pdf-mode thead th{
  position:static !important;
  background:#f4f4f4 !important;
  border:1px solid #ddd !important;
  font-size:11px !important;
  padding:7px !important;
}
body.pdf-mode tbody td{ border:1px solid #ddd !important; padding:7px !important; font-size:11px !important; }
body.pdf-mode .badge{ border:1px solid #ddd !important; background:#fff !important; }

/* ÙŠÙ…Ù†Ø¹ ØªÙ‚Ø·ÙŠØ¹ Ø§Ù„ØµÙ */
body.pdf-mode tr,
body.pdf-mode tbody tr{
  break-inside: avoid !important;
  page-break-inside: avoid !important;
}
</style>
</head>

<body>
<div class="wrap">

  <div class="topbar no-print">
    <div class="row">
      <div class="title">ğŸ“„ ÙˆØ±Ù‚Ø© ØªØ³Ù„ÙŠÙ… A4</div>
      <span class="pill" id="countPill">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„: 0</span>
      <span class="pill" id="sumPill">Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†): 0</span>
      <span class="pill" id="shipSumPill">Ø§Ù„Ø´Ø­Ù†: 0</span>
      <span class="pill right" id="datePill"></span>
    </div>
    <div class="muted" style="margin-top:6px">
      âœ… Ø§Ù„ØµÙØ­Ø© Ø¨ØªÙØªØ­ ÙØ§Ø¶ÙŠØ© â€” Ù‡ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ <b>Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ù„ÙŠ Ø¨ØªØ¹Ù…Ù„Ù‡Ø§ Scan/Ø¥Ø¶Ø§ÙØ© ÙÙ‚Ø·</b>.
    </div>
  </div>

  <div class="card no-print">
    <div class="grid">
      <div class="row">
        <input id="orderIdInput" placeholder="Ø§Ø¯Ø®Ù„ Order ID ÙŠØ¯ÙˆÙŠÙ‹Ø§" style="flex:1;min-width:220px" />
        <button onclick="addOne()">â• Ø¥Ø¶Ø§ÙØ©</button>
      </div>

      <div class="row">
        <button class="secondary" onclick="startScan()">ğŸ“· ØªØ´ØºÙŠÙ„ QR</button>
        <button class="secondary" onclick="stopScan()">â¹ Ø¥ÙŠÙ‚Ø§Ù</button>
        <button class="secondary" onclick="refreshMine()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
      </div>

      <div class="row">
        <button class="danger" onclick="clearMine()">ğŸ§¹ Ù…Ø³Ø­ Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙŠ</button>
        <button onclick="printA4()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="secondary" onclick="downloadSelectedPDF()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ PDF Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
        <button class="secondary" onclick="downloadSelectedCSV() "style="display:none;" >â¬‡ï¸ Excel Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
        <button class="secondary" onclick="downloadAllXLSX()">â¬‡ï¸ Excel (Ø§Ù„Ù…Ø­Ø¯Ø¯)</button>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <select id="statusSelect" style="min-width:220px;flex:1">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„ØªØºÙŠÙŠØ± Ø¨Ø§Ù„Ø¬Ù…Ù„Ø©â€¦</option>
        <option>ØªØ­Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</option>
        <option>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</option>
        <option>ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
        <option>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
        <option>Ù…Ø±ØªØ¬Ø¹</option>
        <option>Ù…Ø±ØªØ¬Ø¹ Ø¬Ø²Ø¦ÙŠ</option>
        <option>Ø§Ù„ØºØ§Ø¡</option>
      </select>

      <button class="danger" onclick="bulkUpdate()">âœï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ù…Ø­Ø¯Ø¯</button>
      <span class="small">* (ØªÙ… Ø§Ù„Ø´Ø­Ù†) ÙŠØ·Ù„Ø¨ Ù…Ù†Ø¯ÙˆØ¨ + ØªØ§Ø±ÙŠØ® Ø´Ø­Ù† â€” (Ù…Ø±ØªØ¬Ø¹ Ø¬Ø²Ø¦ÙŠ) ÙŠØ·Ù„Ø¨ Ù…Ø¨Ù„Øº.</span>
    </div>

    <div id="qrWrap">
      <div class="small" style="margin:8px 0">
        ğŸ“Œ Ø­Ø· Ø§Ù„Ù€ QR Ø¬ÙˆÙ‘Ù‡ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø®Ø¶Ø±. Ø£ÙˆÙ„ Ù…Ø§ ÙŠÙ„Ù‚Ø·: <b style="color:var(--green)">ÙŠØ±Ù† ÙÙˆØ±Ù‹Ø§</b> + ÙŠØ¶ÙŠÙ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±.
      </div>

      <div id="qrBoxOuter">
        <div id="qr-reader"></div>
        <div id="qrOverlay"><div class="frame"></div></div>
      </div>

      <div class="small" style="margin-top:8px">
        Ù„Ùˆ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø´ Ø¨ØªÙØªØ­: Ù„Ø§Ø²Ù… https + Ø§Ø³Ù…Ø­ Ù„Ù„Ù…ØªØµÙØ­ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.
      </div>
    </div>
  </div>

  <div class="card no-print" style="display:none;">
    <div class="title" style="font-size:16px">âœï¸ Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ (Ù„Ùˆ Ù…ÙÙŠØ´ ÙÙˆØ§ØªÙŠØ±)</div>
    <div class="row" style="margin-top:10px">
      <input id="m_id" placeholder="Order ID" />
      <input id="m_name" placeholder="Ø§Ù„Ø§Ø³Ù…" />
      <input id="m_phone" placeholder="Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" />
      <input id="m_city" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©" />
      <input id="m_addr" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" style="min-width:280px; flex:1" />
      <input id="m_sub" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†" />
      <button onclick="manualAdd()">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
  </div>

  <div class="card no-print" id="indexCard">
  <div class="row">
    <div class="title" style="font-size:16px">ğŸ” Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ ÙÙŠ ÙƒÙ„ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª</div>
    <span class="pill right" id="indexStats">â³ Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨Ø­Ø«...</span>
  </div>

  <div class="row" style="margin-top:10px">
    <input id="idx_q" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„ / Order ID / Ø§Ø³Ù… / Ù…Ø­Ø§ÙØ¸Ø©â€¦" style="flex:1;min-width:240px" />
    <button class="secondary" onclick="searchIndex()">Ø¨Ø­Ø«</button>
    <button class="danger" onclick="closeSearchResults()">âœ–ï¸ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
  </div>

  <div class="small" style="margin-top:8px">
    â€¢ Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ (Ù…Ø­Ù„ÙŠ) Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„.  
    â€¢ "Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬" ÙŠØ¹Ø±Ø¶Ù‡Ù… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØªØ­Øª.  
    â€¢ "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬" ØªØ­ÙØ¸Ù‡Ù… Ø¹Ù†Ø¯Ùƒ ÙÙŠ Ø§Ù„Ø¬Ù‡Ø§Ø² (LocalStorage).
  </div>
</div>

<div class="card search-card no-print" id="searchResultsCard" style="display:none;">
  <div class="row">
    <div class="title" style="font-size:16px">ğŸ“Œ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</div>
    <span class="pill right" id="srCount">0 Ù†ØªÙŠØ¬Ø©</span>
  </div>

  <div class="row" style="margin-top:10px">
    <button class="secondary" onclick="srToggleAll()">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
    <button onclick="srAddSelectedToMine()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙŠ</button>
    <button class="danger" onclick="closeSearchResults()">âœ–ï¸ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
  </div>

  <div class="tableWrap" style="margin-top:10px">
    <table>
      <thead>
        <tr>
          <th class="no-print">ØªØ­Ø¯ÙŠØ¯</th>
          <th class="nowrap">Order ID</th>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„Ù‡Ø§ØªÙ / Ù…Ø­Ø§ÙØ¸Ø© / Ø¹Ù†ÙˆØ§Ù†</th>
          <th class="nowrap">Ø§Ù„ØªØ­ØµÙŠÙ„</th>
          <th class="nowrap">Ø§Ù„Ø´Ø­Ù†</th>
          <th class="nowrap">Ø§Ù„Ø­Ø§Ù„Ø©</th>
        </tr>
      </thead>
      <tbody id="srTbody"></tbody>
    </table>
  </div>
</div>

  <div class="card" id="printArea">
    <div class="print-header">
      <div class="print-title">ÙˆØ±Ù‚Ø© ØªØ³Ù„ÙŠÙ… Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ - white-clothes</div>
      <div id="printDate"></div>
    </div>

    <div class="print-summary">
      <div class="print-box">
        <div><b>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</b> <span id="pCount">0</span></div>
        <div><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†):</b> <span id="pSubtotal">0</span></div>
        <div><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø­Ù†:</b> <span id="pShipping">0</span></div>
      </div>
      <div class="print-box">
        <div><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø¨Ø§Ù„Ø´Ø­Ù†):</b> <span id="pTotalWithShip">0</span></div>
        <div><b>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</b> ____________</div>
        <div><b>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</b> ____________</div>
      </div>
      <div class="print-box">
        <div><b>Ù…Ù„Ø§Ø­Ø¸Ø©:</b> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø¨ÙˆØ¹Ø© Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø­</div>
        <div><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> <span id="pDate2"></span></div>
      </div>
    </div>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th class="no-print">
            <button type="button" class="ghost" id="toggleAllBtn" onclick="toggleAll()">
               ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
            </button>
            </th>
            <th class="nowrap">Order ID</th>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ / Ù…Ø­Ø§ÙØ¸Ø© / Ø¹Ù†ÙˆØ§Ù†</th>
            <th class="nowrap">Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†)</th>
            <th class="nowrap">Ø§Ù„Ø´Ø­Ù†</th>
            <th class="nowrap">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

</div>

<div id="toast"></div>

<script>
/** ================== CONFIG ================== **/
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwsMr7euLyvoHz0Sr_k26N_HJYG_O_W5mb061-ljwm-G6I2n0W_Wjb2aiXCk0hg0HkN/exec";
const API_KEY = "123";

/** ================== STATE ================== **/
let rows = [];
let selected = new Set();
let mineIds = new Set();
let qr = null;
let allRowsCache = [];      // ÙƒÙ„ Ø§Ù„Ø¯Ø§ØªØ§ (Ù„Ù„Ù€ index)
let srSelected = new Set(); // ØªØ­Ø¯ÙŠØ¯ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«

let lastScan = { id:"", t:0 };
let scanLockUntil = 0;

document.getElementById("datePill").textContent = new Date().toLocaleString("ar-EG");

/** ================== Persistence ================== **/
const LS_KEY = "scanner_mine_ids_v1";
function loadMine(){
  try{
    const arr = JSON.parse(localStorage.getItem(LS_KEY) || "[]");
    mineIds = new Set(arr.map(x => String(x)));
  }catch(e){ mineIds = new Set(); }
}
function saveMine(){
  localStorage.setItem(LS_KEY, JSON.stringify(Array.from(mineIds)));
}

/** ================== Toast ================== **/
let toastTimer=null;
function toast(msg){
  const el = document.getElementById("toast");
  el.textContent = msg;
  el.style.display = "block";
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> el.style.display="none", 2200);
}

/** ================== BEEP ================== **/
let audioCtx = null;
function beep(){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "sine";
    o.frequency.value = 880;
    g.gain.value = 0.07;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{ o.stop(); }, 120);
  }catch(e){}
  try{ if(navigator.vibrate) navigator.vibrate([50]); }catch(e){}
}

/** ================== HTTP ================== **/
async function api(action, params = {}) {
  const qs = new URLSearchParams({
    action,
    key: API_KEY,
    _t: Date.now(),
    ...params
  }).toString();

  const url = WEB_APP_URL + "?" + qs;
  return await jsonp(url);
}
function jsonp(url){
  return new Promise((resolve,reject)=>{
    const cb = "cb_" + Math.random().toString(36).slice(2);
    window[cb] = (data)=>{ cleanup(); resolve(data); };
    function cleanup(){
      try{ delete window[cb]; }catch(e){ window[cb]=undefined; }
      script.remove();
    }
    const script = document.createElement("script");
    script.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cb;
    script.onerror = ()=>{ cleanup(); reject(new Error("JSONP failed")); };
    document.body.appendChild(script);
  });
}

/** ================== Helpers ================== **/
function esc(s){
  return String(s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function n(v){ const x = Number(v); return isNaN(x)?0:x; }
function statusBadge(status){
  const s = (status||"").trim();
  if (s === "ØªÙ… Ø§Ù„Ø´Ø­Ù†" || s === "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…") return `<span class="badge b-ok">${esc(s||"-")}</span>`;
  if (s === "Ù…Ø±ØªØ¬Ø¹" || s === "Ù…Ø±ØªØ¬Ø¹ Ø¬Ø²Ø¦ÙŠ" || s === "Ø§Ù„ØºØ§Ø¡") return `<span class="badge b-err">${esc(s||"-")}</span>`;
  return `<span class="badge b-warn">${esc(s||"-")}</span>`;
}

/** ================== Render ================== **/
function render(){
  updateToggleBtn();
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  const subtotalSum = rows.reduce((a,r)=> a + n(r.subtotal), 0);
  const shippingSum = rows.reduce((a,r)=> a + n(r.shipping), 0);

  document.getElementById("countPill").textContent = "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„: " + rows.length;
  document.getElementById("sumPill").textContent = "Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†): " + subtotalSum;
  document.getElementById("shipSumPill").textContent = "Ø§Ù„Ø´Ø­Ù†: " + shippingSum;

  rows.forEach(r=>{
    const tr = document.createElement("tr");
    const checked = selected.has(String(r.orderId));

    const phone1 = (r.phone || "").trim();
    const phone2 = (r.altPhone || "").trim();
    const phones = phone2 ? `${esc(phone1)} - ${esc(phone2)}` : `${esc(phone1)}`;

    tr.innerHTML = `
      <td class="no-print"><input type="checkbox" ${checked?"checked":""} /></td>
      <td class="mono"><b>${esc(r.orderId)}</b></td>
      <td>${esc(r.name||"")}</td>
      <td class="addr mono">
  ${phones} / ${esc(r.city||"")} / ${esc(r.address||"")}
</td>
      <td class="mono"><b>${esc(String(r.subtotal||0))}</b></td>
      <td class="mono">${esc(String(r.shipping||0))}</td>
      <td>${statusBadge(r.status)}</td>
    `;

    tr.querySelector("input").addEventListener("change",(e)=>{
      const id = String(r.orderId);
      if (e.target.checked) selected.add(id);
      else selected.delete(id);
    });

    tbody.appendChild(tr);
  });
}

/** ================== Load only MY orders ================== **/
async function refreshMine(){
  if (mineIds.size === 0){
    rows = [];
    selected = new Set();
    render();
    toast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø¹Ù†Ø¯Ùƒ Ù„Ø³Ù‡ â€” Ø§Ø¨Ø¯Ø£ Scan/Ø¥Ø¶Ø§ÙØ©.");
    return;
  }

  const res = await api("scanList");
  if(!res || !res.ok){
    toast("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª: " + (res?.error || "Unknown"));
    return;
  }

  const all = res.rows || [];
  const mine = all.filter(r => mineIds.has(String(r.orderId)));

  const mineOrder = Array.from(mineIds);
  mine.sort((a,b)=> mineOrder.indexOf(String(b.orderId)) - mineOrder.indexOf(String(a.orderId)));

  rows = mine;
  selected = new Set(rows.map(r=>String(r.orderId)));
  render();
}

/** ================== Add one ================== **/
async function addOne(){
  const id = document.getElementById("orderIdInput").value.trim();
  if(!id) return;

  if(mineIds.has(String(id))){
    toast("Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ø¯Ù‡ Ù…ØªØ³Ø¬Ù„ Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„.");
    return;
  }

  mineIds.add(String(id));
  saveMine();

  beep();
  toast("ØªÙ… Ø¥Ø¶Ø§ÙØ©: " + id);

  const res = await api("scanAdd", { orderId:id });
  if(!res || !res.ok){
    toast("ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙˆØ±Ø¯Ø±: " + (res?.error||"Unknown"));
    return;
  }

  document.getElementById("orderIdInput").value="";
  await refreshMine();
}

/** ================== Manual add ================== **/
async function manualAdd(){
  const d = {
    orderId: document.getElementById("m_id").value.trim(),
    name: document.getElementById("m_name").value.trim(),
    phone: document.getElementById("m_phone").value.trim(),
    city: document.getElementById("m_city").value.trim(),
    address: document.getElementById("m_addr").value.trim(),
    subtotal: document.getElementById("m_sub").value.trim(),
  };
  if(!d.orderId) return alert("Ø§ÙƒØªØ¨ Order ID");

  if(mineIds.has(String(d.orderId))){
    toast("Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ø¯Ù‡ Ù…ØªØ³Ø¬Ù„ Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„.");
    return;
  }

  mineIds.add(String(d.orderId));
  saveMine();

  try{
    const res = await api("manualAdd", d);
    if(res && res.ok){}
  }catch(e){}

  ["m_id","m_name","m_phone","m_city","m_addr","m_sub"].forEach(id=>document.getElementById(id).value="");
  beep();
  toast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ÙŠØ¯ÙˆÙŠÙ‹Ø§: " + d.orderId);
  await refreshMine();
}

/** ================== Bulk Update ================== **/
async function bulkUpdate(){
  const status = document.getElementById("statusSelect").value.trim();
  if(!status) return alert("Ø§Ø®ØªØ§Ø± Ø§Ù„Ø­Ø§Ù„Ø©");

  const ids = Array.from(selected);
  if(ids.length===0) return alert("Ù…ÙÙŠØ´ Ø·Ù„Ø¨Ø§Øª Ù…Ø­Ø¯Ø¯Ø©");

  let courier="", shipDate="", deliveryDate="", partialAmount="";

  if(status === "ØªÙ… Ø§Ù„Ø´Ø­Ù†"){
    courier = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ØŸ", "") || "";
    shipDate = prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø­Ù† (YYYY-MM-DD)ØŸ", new Date().toISOString().slice(0,10)) || "";
    if(!courier) return alert("Ù„Ø§Ø²Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨");
  }
  if(status === "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…"){
    deliveryDate = prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… (YYYY-MM-DD)ØŸ", new Date().toISOString().slice(0,10)) || "";
  }
  if(status === "Ù…Ø±ØªØ¬Ø¹ Ø¬Ø²Ø¦ÙŠ"){
    partialAmount = prompt("Ù…Ø¨Ù„Øº Ø§Ù„Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¯ÙØ¹Ù‡ØŸ", "") || "";
    if(!partialAmount) return alert("Ù„Ø§Ø²Ù… ØªÙƒØªØ¨ Ø§Ù„Ù…Ø¨Ù„Øº");
  }

  const res = await api("bulkUpdate", {
    ids: ids.join(","),
    status, courier, shipDate, deliveryDate, partialAmount
  });

  if(!res || !res.ok){
    toast("âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©: " + (res?.error || "Unknown"));
    return;
  }

  toast(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© (${res.updated ?? ids.length})`);
  if(res.missing && res.missing.length){
    toast("âš ï¸ Ø·Ù„Ø¨Ø§Øª Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø©: " + res.missing.join(","));
  }
  await refreshMine();
}

/** ================== Print ================== **/
function updatePrintSummary(){
  const count = rows.length;
  const subtotalSum = rows.reduce((a,r)=>a + n(r.subtotal), 0);
  const shippingSum = rows.reduce((a,r)=>a + n(r.shipping), 0);
  const totalWithShip = subtotalSum + shippingSum;

  const now = new Date().toLocaleString("ar-EG");
  document.getElementById("printDate").textContent = "ØªØ§Ø±ÙŠØ® ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø´Ø­Ù†Ø©: " + now;
  document.getElementById("pDate2").textContent = now;

  document.getElementById("pCount").textContent = count;
  document.getElementById("pSubtotal").textContent = subtotalSum;
  document.getElementById("pShipping").textContent = shippingSum;
  document.getElementById("pTotalWithShip").textContent = totalWithShip;
}
function printA4(){
  updatePrintSummary();
  window.print();
}

/** ================== QR Scan ================== **/
async function startScan(){
  document.getElementById("qrWrap").style.display = "block";

  if(!qr) qr = new Html5Qrcode("qr-reader");

  const config = { fps: 15, qrbox: { width: 260, height: 260 }, aspectRatio: 1.0, disableFlip:false };

  let camId = null;
  try{
    const cams = await Html5Qrcode.getCameras();
    if(cams && cams.length){
      const back = cams.find(c => /back|rear|environment/i.test(c.label));
      camId = (back || cams[0]).id;
    }
  }catch(e){}

  try{
    await qr.start(camId || { facingMode:"environment" }, config, onQrSuccess, ()=>{});
    toast("Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø´ØºØ§Ù„Ø© âœ…");
  }catch(e){
    toast("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + e);
  }
}
async function stopScan(){
  document.getElementById("qrWrap").style.display = "none";
  if(qr){ try{ await qr.stop(); }catch(e){} }
  toast("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù€ QR");
}

async function onQrSuccess(decodedText){
  const now = Date.now();
  if(now < scanLockUntil) return; // lock after success

  const raw = String(decodedText || "").trim();
  const clean = raw.match(/\d+/) ? raw.match(/\d+/)[0] : raw;
  if(!clean) return;

  // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯
  if (lastScan.id === clean && (now - lastScan.t) < 2500) return;
  lastScan = { id: clean, t: now };

  // Ù„Ùˆ Ù…ØªØ³Ø¬Ù„ Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„
  if(mineIds.has(String(clean))){
    toast("âš ï¸ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ø¯Ù‡ Ù…ØªØ³Ø¬Ù„ Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„");
    scanLockUntil = now + 1200;
    return;
  }

  // lock 1.5s Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØªÙ‚Ø±Ø§Ù‡ÙˆØ´ ÙˆØ±Ø§ Ø¨Ø¹Ø¶
  scanLockUntil = now + 1500;

  beep();
  toast("ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· QR: " + clean);

  mineIds.add(String(clean));
  saveMine();

  const res = await api("scanAdd", { orderId: clean });
  if(!res || !res.ok){
    toast("ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙˆØ±Ø¯Ø±: " + (res?.error || "Unknown"));
    return;
  }

  await refreshMine();
}

/** ================== Mine management ================== **/
function clearMine(){
  if(!confirm("Ù‡ØªÙ…Ø³Ø­ Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙƒ Ù…Ù† Ø§Ù„ØµÙØ­Ø© (Ù…Ø´ Ù…Ù† Ø§Ù„Ø´ÙŠØª). Ù…ØªØ£ÙƒØ¯ØŸ")) return;
  mineIds = new Set();
  saveMine();
  rows = [];
  selected = new Set();
  render();
  toast("ØªÙ… Ù…Ø³Ø­ Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙƒ Ù…Ù† Ø§Ù„ØµÙØ­Ø©");
}

  document.getElementById("orderIdInput").addEventListener("keydown", (e)=>{
  if(e.key === "Enter") addOne();
});
document.getElementById("idx_q").addEventListener("keydown", (e)=>{
  if(e.key === "Enter") searchIndex();
});
  function toggleAll(){
  const allIds = rows.map(r => String(r.orderId));
  const allSelected = allIds.every(id => selected.has(id));

  if(allSelected){
    // Ù„Ùˆ ÙƒÙ„Ù‡ Ù…ØªØ­Ø¯Ø¯ â†’ Ø´ÙŠÙ„Ù‡Ù…
    selected.clear();
  }else{
    // Ù„Ùˆ Ù…Ø´ ÙƒÙ„Ù‡ Ù…ØªØ­Ø¯Ø¯ â†’ Ø­Ø¯Ø¯Ù‡Ù… ÙƒÙ„Ù‡Ù…
    allIds.forEach(id => selected.add(id));
  }

  updateToggleBtn();
  render();
}

function updateToggleBtn(){
  const btn = document.getElementById("toggleAllBtn");
  if(!btn) return;

  const allIds = rows.map(r => String(r.orderId));
  const allSelected = allIds.length && allIds.every(id => selected.has(id));

  btn.textContent = allSelected ? "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„" : "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„";
}
  function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
function nextFrame(){ return new Promise(r=>requestAnimationFrame(()=>r())); }

async function downloadSelectedPDF(){
  const ids = Array.from(selected);
  if(ids.length === 0){
    toast("Ø§Ø®ØªØ§Ø± Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„ âœ…");
    return;
  }

  const prevRows = rows.slice();
  const prevSelected = new Set(selected);

  // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
  const filtered = rows.filter(r => ids.includes(String(r.orderId)));
  rows = filtered;
  selected = new Set(ids);

  updatePrintSummary();
  render();

  // ÙØ¹Ù„ ÙˆØ¶Ø¹ PDF (Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©)
  document.body.classList.add("pdf-mode");

  const area = document.getElementById("printArea");
  if(!area){
    toast("âŒ printArea Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯");
    document.body.classList.remove("pdf-mode");
    rows = prevRows; selected = prevSelected; render();
    return;
  }

  // âœ… Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¯ Ù…Ø§ Ø§Ù„Ø³ØªØ§ÙŠÙ„ ÙŠØ«Ø¨Øª + Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ¹Ù…Ù„ layout
  await nextFrame();
  await nextFrame();
  await sleep(250); // Ø¬Ø±Ø¨ 250-500 Ù„Ùˆ Ù„Ø³Ù‡

  // Ø§Ø¬Ø¨Ø§Ø± reflow (Ø¨ÙŠØ³Ø§Ø¹Ø¯ Ù…Ø¹ Ø§Ù„Ù‚Øµ)
  area.style.transform = "translateZ(0)";
  area.offsetHeight; // force reflow
  await nextFrame();

  const opt = {
    margin: 0,
    filename: `white-clothes-${new Date().toISOString().slice(0,10)}.pdf`,
    image: { type: "jpeg", quality: 0.98 },
    html2canvas: {
      scale: 2,
      useCORS: true,
      backgroundColor: "#ffffff",
      scrollX: 0,
      scrollY: 0,
      // âœ… ØªØ«Ø¨ÙŠØª Ù…Ù‚Ø§Ø³ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· (A4 Landscape @96dpi ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§)

    },
    jsPDF: { unit: "mm", format: "a4", orientation: "landscape" },
    pagebreak: { mode: ["css","legacy"] }
  };

  try{
    await html2pdf().set(opt).from(area).save();
    toast("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ PDF Ù„Ù„Ù…Ø­Ø¯Ø¯");
  }catch(e){
    console.error(e);
    toast("âŒ Ø­ØµÙ„ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ PDF");
  }finally{
    document.body.classList.remove("pdf-mode");
    rows = prevRows;
    selected = prevSelected;
    render();
  }
}

function csvEscape(v){
  const s = String(v ?? "");
  // Ù„Ùˆ ÙÙŠÙ‡ ÙØ§ØµÙ„Ø©/Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯/Ø¹Ù„Ø§Ù…Ø© Ø§Ù‚ØªØ¨Ø§Ø³
  if (/[",\n]/.test(s)) return `"${s.replace(/"/g,'""')}"`;
  return s;
}

function downloadSelectedCSV(){
  const ids = Array.from(selected);
  if(ids.length === 0){
    toast("Ø§Ø®ØªØ§Ø± Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„ âœ…");
    return;
  }

  // ØµÙÙˆÙ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
  const filtered = rows.filter(r => ids.includes(String(r.orderId)));

  // Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (Ø¥ÙƒØ³Ù„)
  const header = [
    "Order ID",
    "Ø§Ù„Ø§Ø³Ù…",
    "Ø§Ù„Ù‡Ø§ØªÙ",
    "Ù‡Ø§ØªÙ Ø¥Ø¶Ø§ÙÙŠ",
    "Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©",
    "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
    "Ø§Ù„ØªØ­ØµÙŠÙ„ Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†",
    "Ø§Ù„Ø´Ø­Ù†",
    "Ø§Ù„Ø­Ø§Ù„Ø©"
  ];

  const lines = [header.map(csvEscape).join(",")];

  filtered.forEach(r=>{
    const line = [
      r.orderId,
      r.name,
      r.phone,
      r.altPhone,
      r.city,
      r.address,
      r.subtotal,
      r.shipping,
      r.status
    ].map(csvEscape).join(",");
    lines.push(line);
  });

  // UTF-8 BOM Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙŠØ·Ù„Ø¹ ØµØ­ ÙÙŠ Excel
  const csv = "\uFEFF" + lines.join("\n");
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });

  const a = document.createElement("a");
  const url = URL.createObjectURL(blob);
  a.href = url;
  a.download = `orders_selected_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);

  toast("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Excel (CSV) Ù„Ù„Ù…Ø­Ø¯Ø¯");
}

function downloadAllXLSX(){
  const ids = Array.from(selected);

if(ids.length === 0){
  toast("Ø§Ø®ØªØ§Ø± Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„ âœ…");
  return;
}

// ğŸ‘‡ Ø¨Ø¯Ù„ rows Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø³
const exportRows = rows.filter(r => ids.includes(String(r.orderId)));

  const count = exportRows.length;
  const subtotalSum = exportRows.reduce((a,r)=>a + (Number(r.subtotal)||0), 0);
  const shippingSum  = exportRows.reduce((a,r)=>a + (Number(r.shipping)||0), 0);
  const totalWithShip = subtotalSum + shippingSum;
  const now = new Date().toLocaleString("ar-EG");

  const tableHeader = ["Order ID","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ù‡Ø§ØªÙ","Ù‡Ø§ØªÙ Ø¥Ø¶Ø§ÙÙŠ","Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©","Ø§Ù„Ø¹Ù†ÙˆØ§Ù†","Ø§Ù„ØªØ­ØµÙŠÙ„ Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†","Ø§Ù„Ø´Ø­Ù†","Ø§Ù„Ø­Ø§Ù„Ø©"];
  const tableRows = exportRows.map(r => ([
    String(r.orderId ?? ""),
    String(r.name ?? ""),
    String(r.phone ?? ""),
    String(r.altPhone ?? ""),
    String(r.city ?? ""),
    String(r.address ?? ""),
    Number(r.subtotal || 0),
    Number(r.shipping || 0),
    String(r.status ?? "")
  ]));

  const aoa = [];
  aoa.push(["ÙˆØ±Ù‚Ø© ØªØ³Ù„ÙŠÙ… Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ - white-clothes"]);
  aoa.push([`ØªØ§Ø±ÙŠØ® ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø´Ø­Ù†Ø©: ${now}`]);
  aoa.push([""]);

  // Ø§Ù„Ù…Ù„Ø®Øµ (3 Ø¨Ù„ÙˆÙƒØ§Øª Ø´ÙƒÙ„Ù‡Ù… Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©)
  aoa.push(["Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:", count, "", "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø¨Ø§Ù„Ø´Ø­Ù†):", totalWithShip, "", "Ù…Ù„Ø§Ø­Ø¸Ø©:", "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø¨ÙˆØ¹Ø© Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø­", ""]);
  aoa.push(["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†):", subtotalSum, "", "Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:", "__________", "", "Ø§Ù„ØªØ§Ø±ÙŠØ®:", now, ""]);
  aoa.push(["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø­Ù†:", shippingSum, "", "Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:", "__________", "", "", "", ""]);
  aoa.push([""]);

  const tableHeadRow = aoa.length;   // index Ù‚Ø¨Ù„ Ù…Ø§ Ù†Ø¶ÙŠÙ Ø§Ù„Ù‡ÙŠØ¯Ø±
  aoa.push(tableHeader);
  tableRows.forEach(r => aoa.push(r));

  const wb = XLSX.utils.book_new();

  // âœ… RTL ØµØ­ (Ù…Ø´ ws['!rtl'])
  wb.Workbook = wb.Workbook || {};
  wb.Workbook.Views = [{ RTL: true }];

  const ws = XLSX.utils.aoa_to_sheet(aoa);

// ØªÙƒØ¨ÙŠØ± Ø§Ø±ØªÙØ§Ø¹ Ø£ÙˆÙ„ ØµÙÙŠÙ†
ws["!rows"] = ws["!rows"] || [];
ws["!rows"][0] = { hpt: 40 }; // ØµÙ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
ws["!rows"][1] = { hpt: 28 }; // ØµÙ Ø§Ù„ØªØ§Ø±ÙŠØ®
  // Ø¯Ù…Ø¬ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + Ø³Ø·Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®
  ws["!merges"] = ws["!merges"] || [];
  ws["!merges"].push({ s:{r:0,c:0}, e:{r:0,c:8} });
  ws["!merges"].push({ s:{r:1,c:0}, e:{r:1,c:8} });

  // Ø¹Ø±Ø¶ Ø£Ø¹Ù…Ø¯Ø©
  ws["!cols"] = [
    {wch:10},
    {wch:18},
    {wch:14},
    {wch:14},
    {wch:12},
    {wch:55},
    {wch:18},
    {wch:10},
    {wch:14},
  ];

  // Freeze Ø¹Ù†Ø¯ Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„
  ws["!freeze"] = { xSplit: 0, ySplit: tableHeadRow + 1 };

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø·Ø¨Ø§Ø¹Ø© (Ù„Ùˆ Ø­Ø¯ Ø·Ø¨Ø¹ Ù…Ù† Excel)
  ws["!pageSetup"] = {
    orientation: "landscape",
    fitToWidth: 1,
    fitToHeight: 0
  };

  // ===== Helpers Ù„Ù„Ø³ØªØ§ÙŠÙ„ =====
  function border(style="thin"){
    return {
      top:    { style, color:{rgb:"000000"} },
      bottom: { style, color:{rgb:"000000"} },
      left:   { style, color:{rgb:"000000"} },
      right:  { style, color:{rgb:"000000"} },
    };
  }

  const ref = ws["!ref"];
  const range = XLSX.utils.decode_range(ref);

  const titleRow = 0;
  const dateRow  = 1;
  const summaryStart = 3;
  const summaryEnd = 5; // 3 ØµÙÙˆÙ Ù…Ù„Ø®Øµ
  const tableStart = tableHeadRow;   // Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„
  const tableEnd = range.e.r;

  for(let R=range.s.r; R<=range.e.r; R++){
    for(let C=range.s.c; C<=range.e.c; C++){
      const addr = XLSX.utils.encode_cell({r:R,c:C});
      if(!ws[addr]) continue;

      ws[addr].s = ws[addr].s || {};
      ws[addr].s.alignment = {
        wrapText: true,
        vertical: "top",
        horizontal: "right"
      };

      // Ø¹Ù†ÙˆØ§Ù† + ØªØ§Ø±ÙŠØ®
      if(R === titleRow){
  ws[addr].s.font = { bold:true, sz:22 };
  ws[addr].s.alignment = {
    horizontal: "center",
    vertical: "center",
    wrapText: true
  };
}
      if(R === dateRow){
        ws[addr].s.font = { bold:true };
      }

      // Ù…Ù„Ø®Øµ: Ø¨ÙˆØ±Ø¯Ø± + ØªØ¸Ø¨ÙŠØ·
      if(R >= summaryStart && R <= summaryEnd){
        ws[addr].s.border = border("thin");
        // Ø¨ÙˆØ±Ø¯Ø± Ø®Ø§Ø±Ø¬ÙŠ Ø£Ù‚ÙˆÙ‰ Ø­ÙˆØ§Ù„ÙŠÙ† Ø¨Ù„ÙˆÙƒ Ø§Ù„Ù…Ù„Ø®Øµ
        if(R === summaryStart) ws[addr].s.border.top = { style:"medium", color:{rgb:"000000"} };
        if(R === summaryEnd)   ws[addr].s.border.bottom = { style:"medium", color:{rgb:"000000"} };
        if(C === 0)           ws[addr].s.border.right = { style:"medium", color:{rgb:"000000"} }; // RTL: Ø§Ù„ÙŠÙ…ÙŠÙ† Ø£Ù‡Ù…
        if(C === 8)           ws[addr].s.border.left  = { style:"medium", color:{rgb:"000000"} };
      }

      // Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„
      if(R === tableStart){
        ws[addr].s.font = { bold:true };
        ws[addr].s.fill = { patternType:"solid", fgColor:{rgb:"EDEDED"} };
        ws[addr].s.border = border("medium");
      }

      // Ø¬Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
      if(R > tableStart){
        ws[addr].s.border = border("thin");
      }

      // Ø¥Ø·Ø§Ø± Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ø¬Ø¯ÙˆÙ„ ÙƒÙ„Ù‡ (Ø£ÙˆØ¶Ø­)
      if(R >= tableStart && R <= tableEnd){
        if(R === tableStart) ws[addr].s.border.top = { style:"medium", color:{rgb:"000000"} };
        if(R === tableEnd)   ws[addr].s.border.bottom = { style:"medium", color:{rgb:"000000"} };
        if(C === 0)          ws[addr].s.border.right = { style:"medium", color:{rgb:"000000"} }; // RTL
        if(C === 8)          ws[addr].s.border.left  = { style:"medium", color:{rgb:"000000"} };
      }
    }
  }

  XLSX.utils.book_append_sheet(wb, ws, "Delivery Sheet");
  XLSX.writeFile(wb, `white-clothes-${new Date().toISOString().slice(0,10)}.xlsx`);
  toast("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Excel (ÙƒÙ„ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª) Ø¨Ø§Ù„Ù‡ÙŠØ¯Ø± + Ø¨ÙˆØ±Ø¯Ø± + RTL");
}

// ====== INDEX: ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¯Ø§ØªØ§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ======
async function loadAllForIndex(){
  document.getElementById("indexStats").textContent = "â³ Ø¨ÙŠØ¬Ù‡Ø² Ø§Ù„Ø¯Ø§ØªØ§...";
  try{
    const res = await api("scanList"); // Ù†ÙØ³ Ø§Ù„Ø¯Ø§ØªØ§ Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ø´ÙŠØª
    if(!res || !res.ok){
      document.getElementById("indexStats").textContent = "âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§ØªØ§";
      toast("Ø®Ø·Ø£: " + (res?.error || "Unknown"));
      return;
    }
    allRowsCache = res.rows || [];
    document.getElementById("indexStats").textContent = `âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø­Ø« (${allRowsCache.length})`;
  }catch(e){
    document.getElementById("indexStats").textContent = "âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§ØªØ§";
    toast("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§ØªØ§");
  }
}

// ====== INDEX: Ø¨Ø­Ø« Ù…Ø­Ù„ÙŠ Ø³Ø±ÙŠØ¹ ======
function norm(s){
  return String(s ?? "")
    .trim()
    .toLowerCase();
}

function rowHaystack(r){
  // Ù‡Ù†Ø¨Ø­Ø« ÙÙŠ Ø£Ù‡Ù… Ø§Ù„Ø­Ù‚ÙˆÙ„
  return norm([
    r.orderId, r.name, r.phone, r.altPhone, r.city, r.address, r.status
  ].join(" | "));
}

function searchIndex(){
  const q = norm(document.getElementById("idx_q").value);

  // Ù„Ùˆ ÙØ§Ø¶ÙŠ: Ø§Ù‚ÙÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ø±Ø¬Ø¹ Ù„Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙŠ
  if(!q){
    closeSearchResults();
    refreshMine();
    toast("Ø±Ø¬Ø¹Ù†Ø§ Ù„Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙƒ");
    return;
  }

  if(!allRowsCache || allRowsCache.length === 0){
    toast("Ø§Ù„Ø¯Ø§ØªØ§ Ù„Ø³Ù‡ Ù…Ø­Ù…Ù„ØªØ´.. Ø§Ø³ØªÙ†Ù‰ Ø«ÙˆØ§Ù†ÙŠ");
    return;
  }

  const digits = q.replace(/\D/g,"");
  const isDigits = digits.length >= 4;

  const results = allRowsCache.filter(r=>{
    const h = rowHaystack(r);
    if(isDigits){
      const o = String(r.orderId ?? "");
      const p1 = String(r.phone ?? "");
      const p2 = String(r.altPhone ?? "");
      return o.includes(digits) || p1.includes(digits) || p2.includes(digits) || h.includes(q);
    }
    return h.includes(q);
  });

  lastIndexResults = results;
  srSelected.clear();

  document.getElementById("indexStats").textContent = `ğŸ” Ù†ØªØ§Ø¦Ø¬: ${results.length}`;
  renderSearchResults();          // âœ… ÙŠØ¹Ø±Ø¶ ÙÙŠ Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù†ÙØµÙ„ ÙÙˆØ±Ù‹Ø§
  document.getElementById("searchResultsCard")
  ?.scrollIntoView({ behavior: "smooth", block: "start" });
}
// ====== INDEX: Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØªØ­Øª ======
function renderSearchResults(){
  const card = document.getElementById("searchResultsCard");
  const tbody = document.getElementById("srTbody");
  const countEl = document.getElementById("srCount");

  if(!lastIndexResults || lastIndexResults.length === 0){
    card.style.display = "none";
    tbody.innerHTML = "";
    srSelected.clear();
    return;
  }

  card.style.display = "block";
  document.body.classList.add("search-open");
  countEl.textContent = `${lastIndexResults.length} Ù†ØªÙŠØ¬Ø©`;
  tbody.innerHTML = "";

  lastIndexResults.forEach(r=>{
    const id = String(r.orderId ?? "");
    const checked = srSelected.has(id);

    const phone1 = (r.phone || "").trim();
    const phone2 = (r.altPhone || "").trim();
    const phones = phone2 ? `${esc(phone1)} - ${esc(phone2)}` : `${esc(phone1)}`;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="no-print"><input type="checkbox" ${checked?"checked":""}></td>
      <td class="mono"><b>${esc(id)}</b></td>
      <td>${esc(r.name||"")}</td>
      <td class="addr mono">${phones} / ${esc(r.city||"")} / ${esc(r.address||"")}</td>
      <td class="mono"><b>${esc(String(r.subtotal||0))}</b></td>
      <td class="mono">${esc(String(r.shipping||0))}</td>
      <td>${statusBadge(r.status)}</td>
    `;

    tr.querySelector("input").addEventListener("change",(e)=>{
      if(e.target.checked) srSelected.add(id);
      else srSelected.delete(id);
    });

    tbody.appendChild(tr);
  });
}

function srToggleAll(){
  if(!lastIndexResults || lastIndexResults.length === 0) return;

  const allIds = lastIndexResults.map(r => String(r.orderId));
  const allSelected = allIds.every(id => srSelected.has(id));

  if(allSelected) srSelected.clear();
  else allIds.forEach(id => srSelected.add(id));

  renderSearchResults();
}

function closeSearchResults(){
  lastIndexResults = [];
  srSelected.clear();
  document.getElementById("searchResultsCard").style.display = "none";
  document.getElementById("srTbody").innerHTML = "";
  document.getElementById("idx_q").value = "";
  document.getElementById("indexStats").textContent = `âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø­Ø« (${allRowsCache.length})`;
}
document.body.classList.remove("search-open");

function srAddSelectedToMine(){
  const ids = Array.from(srSelected);
  if(ids.length === 0){
    toast("Ø­Ø¯Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£ÙˆÙ„ âœ…");
    return;
  }

  let added = 0;
  ids.forEach(id=>{
    const cleanId = String(id).trim();
    if(!mineIds.has(cleanId)){
      mineIds.add(cleanId);
      added++;
    }
  });

  saveMine();
  toast(`âœ… Ø§ØªØ¶Ø§Ù ${added} Ø£ÙˆØ±Ø¯Ø± Ù„Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙƒ`);

  // Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: Ø§Ù‚ÙÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ø±Ø¬Ø¹ Ù„Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙŠ
  closeSearchResults();
  refreshMine();
}
const qEl = document.getElementById("idx_q");
const statsEl = document.getElementById("indexStats");

qEl.addEventListener("input", () => {
  const q = qEl.value.trim().toLowerCase();

  if (!q) {
    statsEl.textContent = `âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø­Ø« (${allRowsCache.length})`;
    return;
  }

  const filtered = allRowsCache.filter(row => {
    return Object.values(row).some(val =>
      String(val).toLowerCase().includes(q)
    );
  });

  statsEl.textContent = `ğŸ” Ù†ØªØ§Ø¦Ø¬ Ù…ØªÙˆÙ‚Ø¹Ø©: ${filtered.length}`;
});
/** ================== Boot ================== **/
loadMine();
render();
refreshMine();       // ÙŠØ¹Ø±Ø¶ Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙƒ Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø©
loadAllForIndex();   // ÙŠØ¬Ù‡Ø² Ø§Ù„Ø¯Ø§ØªØ§ Ù„Ù„Ø¨Ø­Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠ
</script>
</body>
</html>
